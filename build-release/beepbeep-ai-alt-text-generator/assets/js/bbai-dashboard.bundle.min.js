/**
* Dashboard Bundle
* Auto-generated from modular source files
* DO NOT EDIT DIRECTLY - Edit source files in assets/src/js/dashboard/
*
* @package BeepBeep_AI
* @since 5.0.0
* @generated 2026-01-16T22:06:49.023Z
*/
/* ============================================
* utils.js
* ============================================ */
/**
* Dashboard Utilities
* jQuery wrapper, DOM caching, and helper functions
*
* @package BeepBeep_AI
* @since 5.0.0
*/
var alttextaiDebug = (typeof window.bbai_ajax !== 'undefined' && window.bbai_ajax.debug) || false;
/**
* Safe jQuery wrapper that checks for jQuery availability
*/
var bbaiRunWithJQuery = (function() {
var warned = false;
return function(callback) {
var jq = window.jQuery || window.$;
if (typeof jq !== 'function') {
if (!warned) {
console.warn('[AltText AI] jQuery not found; dashboard scripts not run.');
warned = true;
}
return;
}
callback(jq);
};
})();
/**
* DOM element cache for performance
*/
var $cachedElements = {};
function getCachedElement(selector) {
var $ = window.jQuery || window.$;
if (typeof $ !== 'function') return null;
if (!$cachedElements[selector]) {
$cachedElements[selector] = $(selector);
}
return $cachedElements[selector];
}
/**
* Clear element cache (useful after AJAX updates)
*/
function clearElementCache() {
$cachedElements = {};
}
var bbaiApp = bbaiApp || {};
window.bbaiRunWithJQuery = bbaiRunWithJQuery;
window.getCachedElement = getCachedElement;
window.clearElementCache = clearElementCache;
/* ============================================
* upgrade-modal.js
* ============================================ */
/**
* Upgrade Modal
* Show/hide upgrade modal and handle triggers
*
* @package BeepBeep_AI
* @since 5.0.0
*/
var FALLBACK_UPGRADE_SELECTOR = [
'.bbai-upgrade-link',
'.bbai-upgrade-inline',
'.bbai-upgrade-cta-card button',
'.bbai-upgrade-cta-card a',
'.bbai-pro-upsell-card button',
'.bbai-upgrade-banner button',
'.bbai-upgrade-banner a',
'.bbai-hero-actions [data-cta="upgrade"]',
'.bbai-upgrade-callout button',
'.bbai-upgrade-callout a',
'[data-upgrade-trigger="true"]'
].join(', ');
/**
* Show upgrade modal
*/
function alttextaiShowModal() {
if (alttextaiDebug) console.log('[AltText AI] alttextaiShowModal() called');
var modal = document.getElementById('bbai-upgrade-modal');
if (!modal) {
console.error('[AltText AI] Upgrade modal element not found in DOM!');
var byClass = document.querySelector('.bbai-modal-backdrop');
if (byClass) {
byClass.id = 'bbai-upgrade-modal';
return alttextaiShowModal();
}
if (window.bbaiModal) {
window.bbaiModal.warning('Upgrade modal not found. Please refresh the page.');
}
return false;
}
if (modal.style.display === 'none') {
modal.style.display = 'flex';
modal.style.opacity = '0';
modal.style.visibility = 'hidden';
}
void modal.offsetHeight;
modal.classList.add('active');
modal.removeAttribute('aria-hidden');
document.body.style.overflow = 'hidden';
setTimeout(function() {
var closeBtn = modal.querySelector('.bbai-upgrade-modal__close, .bbai-modal-close, [data-action="close-modal"], button[aria-label*="Close"]');
if (closeBtn && typeof closeBtn.focus === 'function') {
closeBtn.focus();
}
}, 150);
return true;
}
/**
* Close upgrade modal
*/
function alttextaiCloseModal() {
var modal = document.getElementById('bbai-upgrade-modal');
if (modal) {
modal.classList.remove('active');
setTimeout(function() {
modal.style.display = 'none';
modal.setAttribute('aria-hidden', 'true');
}, 300);
document.body.style.overflow = '';
}
}
/**
* Unified handler for upgrade triggers
*/
function handleUpgradeTrigger(event, triggerElement) {
if (event) {
event.preventDefault();
event.stopPropagation();
}
try {
if (typeof alttextaiShowModal === 'function') {
alttextaiShowModal();
} else {
var modal = document.getElementById('bbai-upgrade-modal');
if (modal) {
modal.style.display = 'flex';
modal.setAttribute('aria-hidden', 'false');
document.body.style.overflow = 'hidden';
}
}
} catch (err) {
if (alttextaiDebug) console.error('[AltText AI] Error in handleUpgradeTrigger:', err);
}
}
/**
* Bind direct upgrade handlers
*/
function bindDirectUpgradeHandlers(targetSelector) {
var selector = targetSelector || FALLBACK_UPGRADE_SELECTOR;
if (!selector) return;
var nodes = document.querySelectorAll(selector);
if (!nodes || !nodes.length) return;
nodes.forEach(function(el) {
if (!el) return;
if (el.dataset && el.dataset.upgradeBound === '1') return;
el.addEventListener('click', function(event) {
handleUpgradeTrigger(event, el);
}, true);
if (el.dataset) {
el.dataset.upgradeBound = '1';
}
});
}
/**
* Bind fallback listeners for upgrade CTAs
*/
function bindFallbackUpgradeTriggers() {
if (!FALLBACK_UPGRADE_SELECTOR) return;
document.addEventListener('click', function(event) {
var fallbackTrigger = event.target && event.target.closest(FALLBACK_UPGRADE_SELECTOR);
if (!fallbackTrigger) return;
if (fallbackTrigger.closest('[data-action="show-upgrade-modal"]')) return;
handleUpgradeTrigger(event, fallbackTrigger);
}, true);
}
/**
* Add data-action attributes to CTAs missing them
*/
function ensureUpgradeAttributes(targetSelector) {
var selector = targetSelector || FALLBACK_UPGRADE_SELECTOR;
if (!selector) return;
var nodes = document.querySelectorAll(selector);
if (!nodes || !nodes.length) return;
nodes.forEach(function(el) {
if (!el) return;
if (!el.hasAttribute('data-action')) {
el.setAttribute('data-action', 'show-upgrade-modal');
}
el.setAttribute('data-upgrade-trigger', 'true');
});
bindDirectUpgradeHandlers(selector);
}
/**
* Observe DOM for future upgrade triggers
*/
function observeFutureUpgradeTriggers() {
if (typeof MutationObserver === 'undefined' || !FALLBACK_UPGRADE_SELECTOR) return;
var observer = new MutationObserver(function(mutations) {
mutations.forEach(function(mutation) {
if (!mutation.addedNodes || !mutation.addedNodes.length) return;
mutation.addedNodes.forEach(function(node) {
if (!node || node.nodeType !== 1) return;
if (node.matches && node.matches(FALLBACK_UPGRADE_SELECTOR)) {
ensureUpgradeAttributes();
} else if (node.querySelector) {
var matches = node.querySelector(FALLBACK_UPGRADE_SELECTOR);
if (matches) {
ensureUpgradeAttributes();
}
}
});
});
});
observer.observe(document.body, { childList: true, subtree: true });
}
/**
* Check if modal exists
*/
function checkModalExists() {
var modal = document.getElementById('bbai-upgrade-modal');
if (!modal) {
console.warn('[AltText AI] Upgrade modal not found in DOM. Make sure upgrade-modal.php is included.');
} else {
if (alttextaiDebug) console.log('[AltText AI] Upgrade modal found in DOM');
}
}
window.alttextaiShowModal = alttextaiShowModal;
window.alttextaiCloseModal = alttextaiCloseModal;
window.handleUpgradeTrigger = handleUpgradeTrigger;
window.bindFallbackUpgradeTriggers = bindFallbackUpgradeTriggers;
window.ensureUpgradeAttributes = ensureUpgradeAttributes;
window.observeFutureUpgradeTriggers = observeFutureUpgradeTriggers;
bbaiApp.showModal = alttextaiShowModal;
bbaiApp.closeModal = alttextaiCloseModal;
window.testUpgradeModal = function() {
console.log('=== Testing Upgrade Modal ===');
var modal = document.getElementById('bbai-upgrade-modal');
console.log('Modal element:', modal);
if (modal) {
console.log('Modal HTML:', modal.outerHTML.substring(0, 200));
alttextaiShowModal();
} else {
console.error('Modal not found!');
}
};
/* ============================================
* subscription.js
* ============================================ */
/**
* Subscription Management
* Load, display, and cache subscription info
*
* @package BeepBeep_AI
* @since 5.0.0
*/
var retryAttempts = 0;
var maxRetries = 5;
var retryTimeout = null;
/**
* Load subscription information from backend
*/
function loadSubscriptionInfo(forceRefresh) {
var $ = window.jQuery || window.$;
if (typeof $ !== 'function') return;
var $loading = getCachedElement('#bbai-subscription-loading');
var $error = getCachedElement('#bbai-subscription-error');
var $info = getCachedElement('#bbai-subscription-info');
var $freeMessage = getCachedElement('#bbai-free-plan-message');
if (!forceRefresh) {
var cached = getCachedSubscriptionInfo();
if (cached) {
displaySubscriptionInfo(cached.data);
return;
}
}
$loading.show();
$error.hide();
$info.hide();
$freeMessage.hide();
if (!window.bbai_ajax || !window.bbai_ajax.ajaxurl) {
showSubscriptionError('Configuration error. Please refresh the page.');
return;
}
$.ajax({
url: window.bbai_ajax.ajaxurl,
type: 'POST',
data: {
action: 'beepbeepai_get_subscription_info',
nonce: window.bbai_ajax.nonce
},
success: function(response) {
$loading.hide();
if (response.success && response.data) {
resetRetryAttempts();
cacheSubscriptionInfo(response.data);
displaySubscriptionInfo(response.data);
var urlParams = new URLSearchParams(window.location.search);
if (urlParams.get('portal_return') === 'success') {
var cleanUrl = window.location.pathname + window.location.search.replace(/[?&]portal_return=success/, '').replace(/^&/, '?');
if (cleanUrl !== window.location.pathname + window.location.search) {
window.history.replaceState({}, document.title, cleanUrl);
}
setTimeout(function() {
loadSubscriptionInfo(true);
}, 2000);
}
} else {
var plan = response.data?.plan || 'free';
if (plan === 'free') {
$freeMessage.show();
} else {
var errorMessage = response.data?.message || 'Failed to load subscription information.';
showSubscriptionError(errorMessage);
}
}
},
error: function(xhr, status) {
$loading.hide();
var errorMessage = 'Network error. Please try again.';
if (xhr.status === 401 || xhr.status === 403) {
showSubscriptionError('Please log in to view your subscription information.');
return;
} else if (xhr.status === 404) {
showSubscriptionError('Subscription information not found.');
return;
} else if (xhr.status >= 500 || status === 'timeout' || status === 'error') {
showSubscriptionError('Service temporarily unavailable. Retrying automatically...');
retrySubscriptionLoad();
return;
}
showSubscriptionError(errorMessage);
}
});
}
/**
* Display subscription information
*/
function displaySubscriptionInfo(data) {
var $info = getCachedElement('#bbai-subscription-info');
var $error = getCachedElement('#bbai-subscription-error');
var $freeMessage = getCachedElement('#bbai-free-plan-message');
$error.hide();
$freeMessage.hide();
if (!data.plan || data.plan === 'free' || data.status === 'free') {
$freeMessage.show();
return;
}
var status = data.status || 'active';
var statusBadge = getCachedElement('#bbai-status-badge');
var statusLabel = statusBadge.find('.bbai-status-label');
statusBadge.removeClass('bbai-status-active bbai-status-cancelled bbai-status-trial');
statusBadge.addClass('bbai-status-' + status);
statusLabel.text(status.charAt(0).toUpperCase() + status.slice(1));
var $cancelWarning = getCachedElement('#bbai-cancel-warning');
if (data.cancelAtPeriodEnd) {
$cancelWarning.show();
} else {
$cancelWarning.hide();
}
var planName = data.plan ? data.plan.charAt(0).toUpperCase() + data.plan.slice(1) : '-';
getCachedElement('#bbai-plan-name').text(planName);
var billingCycle = data.billingCycle ? data.billingCycle.charAt(0).toUpperCase() + data.billingCycle.slice(1) : '-';
getCachedElement('#bbai-billing-cycle').text(billingCycle);
if (data.nextBillingDate) {
var date = new Date(data.nextBillingDate);
getCachedElement('#bbai-next-billing').text(date.toLocaleDateString('en-US', {
year: 'numeric',
month: 'long',
day: 'numeric'
}));
} else {
getCachedElement('#bbai-next-billing').text('-');
}
if (data.nextChargeAmount !== undefined && data.nextChargeAmount !== null) {
var currency = data.currency || 'GBP';
var symbol = currency === 'USD' ? '$' : currency === 'EUR' ? 'â‚¬' : 'Â£';
getCachedElement('#bbai-next-charge').text(symbol + parseFloat(data.nextChargeAmount).toFixed(2));
} else {
getCachedElement('#bbai-next-charge').text('-');
}
if (data.paymentMethod && data.paymentMethod.last4) {
var $paymentMethod = getCachedElement('#bbai-payment-method');
var brand = data.paymentMethod.brand || 'card';
var last4 = data.paymentMethod.last4;
var expMonth = data.paymentMethod.expMonth;
var expYear = data.paymentMethod.expYear;
getCachedElement('#bbai-card-brand').text(getCardBrandIcon(brand) + ' ' + brand.toUpperCase());
getCachedElement('#bbai-card-last4').text('â€¢â€¢â€¢â€¢ ' + last4);
if (expMonth && expYear) {
getCachedElement('#bbai-card-expiry').text(expMonth + '/' + expYear.toString().slice(-2));
}
$paymentMethod.show();
} else {
getCachedElement('#bbai-payment-method').hide();
}
$info.show();
}
/**
* Retry subscription load with exponential backoff
*/
function retrySubscriptionLoad() {
var $ = window.jQuery || window.$;
if (typeof $ !== 'function') return;
if (retryAttempts >= maxRetries) {
showSubscriptionError('Service unavailable after multiple attempts. Please try again later or refresh the page.');
retryAttempts = 0;
return;
}
retryAttempts++;
var delay = Math.min(1000 * Math.pow(2, retryAttempts - 1), 16000);
var $error = $('#bbai-subscription-error');
$error.find('.bbai-error-message').text(
'Service temporarily unavailable. Retrying in ' + Math.ceil(delay / 1000) + ' seconds... (Attempt ' + retryAttempts + '/' + maxRetries + ')'
);
if (retryTimeout) {
clearTimeout(retryTimeout);
}
retryTimeout = setTimeout(function() {
loadSubscriptionInfo(true);
}, delay);
}
/**
* Reset retry attempts on successful load
*/
function resetRetryAttempts() {
retryAttempts = 0;
if (retryTimeout) {
clearTimeout(retryTimeout);
retryTimeout = null;
}
}
/**
* Show subscription error
*/
function showSubscriptionError(message) {
var $ = window.jQuery || window.$;
if (typeof $ !== 'function') return;
var $error = $('#bbai-subscription-error');
var $info = $('#bbai-subscription-info');
var $freeMessage = $('#bbai-free-plan-message');
$error.find('.bbai-error-message').text(message);
$error.show();
$info.hide();
$freeMessage.hide();
}
/**
* Get card brand icon/emoji
*/
function getCardBrandIcon(brand) {
var icons = {
'visa': 'ðŸ’³',
'mastercard': 'ðŸ’³',
'amex': 'ðŸ’³',
'discover': 'ðŸ’³',
'diners': 'ðŸ’³',
'jcb': 'ðŸ’³',
'unionpay': 'ðŸ’³'
};
return icons[brand.toLowerCase()] || 'ðŸ’³';
}
/**
* Cache subscription info in localStorage
*/
function cacheSubscriptionInfo(data) {
try {
var cacheData = {
data: data,
timestamp: Date.now(),
expiry: 15 * 60 * 1000
};
localStorage.setItem('bbai_subscription_cache', JSON.stringify(cacheData));
} catch (e) {
console.warn('[AltText AI] Could not cache subscription info:', e);
}
}
/**
* Get cached subscription info if still valid
*/
function getCachedSubscriptionInfo() {
try {
var cached = localStorage.getItem('bbai_subscription_cache');
if (!cached) return null;
var cacheData = JSON.parse(cached);
var age = Date.now() - cacheData.timestamp;
if (age < cacheData.expiry) {
return cacheData;
} else {
localStorage.removeItem('bbai_subscription_cache');
return null;
}
} catch (e) {
console.warn('[AltText AI] Could not read subscription cache:', e);
return null;
}
}
window.loadSubscriptionInfo = loadSubscriptionInfo;
window.displaySubscriptionInfo = displaySubscriptionInfo;
window.cacheSubscriptionInfo = cacheSubscriptionInfo;
window.getCachedSubscriptionInfo = getCachedSubscriptionInfo;
/* ============================================
* auth.js
* ============================================ */
/**
* Authentication Handlers
* Auth banner, login, logout functionality
*
* @package BeepBeep_AI
* @since 5.0.0
*/
/**
* Show auth banner
*/
function showAuthBanner() {
if (alttextaiDebug) console.log('[AltText AI] Showing auth banner');
if (typeof window.authModal !== 'undefined' && window.authModal && typeof window.authModal.show === 'function') {
window.authModal.show();
} else {
var authModal = document.getElementById('alttext-auth-modal');
if (authModal) {
authModal.style.display = 'block';
} else {
if (window.bbaiModal) {
window.bbaiModal.error('Authentication system not available. Please refresh the page.');
}
}
}
}
/**
* Show auth login modal
*/
function showAuthLogin() {
if (alttextaiDebug) console.log('[AltText AI] Showing auth login');
if (window.bbaiApp && window.bbaiApp.authModal && typeof window.bbaiApp.authModal.show === 'function') {
window.bbaiApp.authModal.show();
return;
} else if (typeof window.AltTextAuthModal !== 'undefined' && window.AltTextAuthModal && typeof window.AltTextAuthModal.show === 'function') {
window.AltTextAuthModal.show();
return;
}
if (typeof window.authModal !== 'undefined' && window.authModal && typeof window.authModal.show === 'function') {
window.authModal.show();
return;
}
showAuthBanner();
}
/**
* Show auth modal with specific tab
*/
function showAuthModal(tab) {
if (alttextaiDebug) console.log('[AltText AI] Showing auth modal, tab:', tab);
if (typeof window.authModal !== 'undefined' && window.authModal && typeof window.authModal.show === 'function') {
window.authModal.show();
if (tab === 'register' && typeof window.authModal.showRegisterForm === 'function') {
window.authModal.showRegisterForm();
} else if (typeof window.authModal.showLoginForm === 'function') {
window.authModal.showLoginForm();
}
return;
}
showAuthLogin();
}
/**
* Handle logout
*/
function handleLogout() {
if (window.alttextaiDebug) console.log('[AltText AI] Handling logout');
if (typeof window.bbai_ajax === 'undefined') {
if (window.alttextaiDebug) console.warn('[AltText AI] bbai_ajax object not found');
if (typeof localStorage !== 'undefined') {
localStorage.removeItem('alttextai_token');
}
window.location.reload();
return;
}
var ajaxUrl = window.bbai_ajax.ajax_url || window.bbai_ajax.ajaxurl || window.ajaxurl;
var nonce = window.bbai_ajax.nonce || '';
if (!ajaxUrl) {
if (window.alttextaiDebug) console.warn('[AltText AI] AJAX URL not found');
window.location.reload();
return;
}
if (typeof jQuery !== 'undefined' && jQuery.ajax) {
jQuery.ajax({
url: ajaxUrl,
type: 'POST',
data: {
action: 'beepbeepai_logout',
nonce: nonce
},
success: function(response) {
if (window.alttextaiDebug) console.log('[AltText AI] Logout successful', response);
if (typeof localStorage !== 'undefined') {
localStorage.removeItem('alttextai_token');
}
var redirect = (window.bbai_ajax && (window.bbai_ajax.logout_redirect || window.bbai_ajax.ajax_url)) || window.location.href;
window.location.href = redirect;
},
error: function(xhr, status, error) {
if (window.alttextaiDebug) console.warn('[AltText AI] Logout failed:', error);
if (typeof localStorage !== 'undefined') {
localStorage.removeItem('alttextai_token');
}
var redirect = (window.bbai_ajax && (window.bbai_ajax.logout_redirect || window.bbai_ajax.ajax_url)) || window.location.href;
window.location.href = redirect;
}
});
} else {
var formData = new FormData();
formData.append('action', 'alttextai_logout');
formData.append('nonce', nonce);
fetch(ajaxUrl, {
method: 'POST',
body: formData,
credentials: 'same-origin'
})
.then(function(response) {
return response.json().catch(function() { return {}; });
})
.then(function() {
if (typeof localStorage !== 'undefined') {
localStorage.removeItem('alttextai_token');
}
var redirect = (window.bbai_ajax && (window.bbai_ajax.logout_redirect || window.bbai_ajax.ajax_url)) || window.location.href;
window.location.href = redirect;
})
.catch(function() {
if (typeof localStorage !== 'undefined') {
localStorage.removeItem('alttextai_token');
}
var redirect = (window.bbai_ajax && (window.bbai_ajax.logout_redirect || window.bbai_ajax.ajax_url)) || window.location.href;
window.location.href = redirect;
});
}
}
/**
* Disconnect account
*/
function disconnectAccount($btn) {
var $ = window.jQuery || window.$;
if (typeof $ !== 'function') return;
if (!window.bbai_ajax || !window.bbai_ajax.ajaxurl) {
if (window.bbaiModal) {
window.bbaiModal.error('Configuration error. Please refresh the page.');
}
return;
}
$btn.prop('disabled', true).addClass('bbai-btn-loading');
var originalText = $btn.text();
$btn.html('<span class="bbai-spinner"></span> Disconnecting...');
$.ajax({
url: window.bbai_ajax.ajaxurl,
type: 'POST',
data: {
action: 'beepbeepai_disconnect_account',
nonce: window.bbai_ajax.nonce
},
timeout: 15000,
success: function(response) {
if (response.success) {
$btn.removeClass('bbai-btn-loading').html('âœ“ Disconnected');
if (typeof localStorage !== 'undefined') {
localStorage.removeItem('bbai_subscription_cache');
localStorage.removeItem('alttextai_token');
}
if (response.data && response.data.redirect) {
window.location.href = response.data.redirect;
} else {
setTimeout(function() {
window.location.reload();
}, 500);
}
} else {
$btn.prop('disabled', false)
.removeClass('bbai-btn-loading')
.text(originalText);
var errorMsg = response.data?.message || 'Failed to disconnect. Please try again.';
if (window.bbaiModal) {
window.bbaiModal.error(errorMsg);
}
}
},
error: function(xhr, status) {
$btn.prop('disabled', false)
.removeClass('bbai-btn-loading')
.text(originalText);
var errorMessage = 'Unable to disconnect. Please try again.';
if (status === 'timeout') {
errorMessage = 'Request timed out. Try refreshing the page.';
}
if (window.bbaiModal) {
window.bbaiModal.error(errorMessage);
}
}
});
}
window.showAuthBanner = showAuthBanner;
window.showAuthLogin = showAuthLogin;
window.showAuthModal = showAuthModal;
window.handleLogout = handleLogout;
window.disconnectAccount = disconnectAccount;
/* ============================================
* portal.js
* ============================================ */
/**
* Customer Portal
* Stripe billing portal integration
*
* @package BeepBeep_AI
* @since 5.0.0
*/
/**
* Open customer portal
*/
function openCustomerPortal() {
var $ = window.jQuery || window.$;
if (typeof $ !== 'function') return;
if (alttextaiDebug) console.log('[AltText AI] Opening customer portal');
if (!window.bbai_ajax || !window.bbai_ajax.ajaxurl) {
if (window.bbaiModal) {
window.bbaiModal.error('Configuration error. Please refresh the page.');
}
return;
}
var $overlay = $('<div class="bbai-portal-loading-overlay">Loading billing portal...</div>');
$('body').append($overlay);
$.ajax({
url: window.bbai_ajax.ajaxurl,
type: 'POST',
data: {
action: 'beepbeepai_create_portal_session',
nonce: window.bbai_ajax.nonce
},
timeout: 30000,
success: function(response) {
$overlay.remove();
if (response.success && response.data && response.data.url) {
if (alttextaiDebug) console.log('[AltText AI] Portal URL received, redirecting');
window.location.href = response.data.url;
} else {
var errorMsg = response.data?.message || 'Could not open billing portal. Please try again.';
if (window.bbaiModal) {
window.bbaiModal.error(errorMsg);
}
}
},
error: function(xhr, status, error) {
$overlay.remove();
if (alttextaiDebug) console.error('[AltText AI] Portal error:', status, error);
var errorMessage = 'Unable to open billing portal. Please try again.';
if (status === 'timeout') {
errorMessage = 'Request timed out. Please try again.';
} else if (xhr.status === 401 || xhr.status === 403) {
errorMessage = 'Please log in to access the billing portal.';
}
if (window.bbaiModal) {
window.bbaiModal.error(errorMessage);
}
}
});
}
/**
* Check if portal should open after login
*/
function checkPortalAfterLogin() {
var shouldOpenPortal = localStorage.getItem('bbai_open_portal_after_login');
if (shouldOpenPortal === 'true') {
if (alttextaiDebug) console.log('[AltText AI] Portal flag found, checking authentication...');
var checkCount = 0;
var maxChecks = 10;
var checkInterval = setInterval(function() {
checkCount++;
var isAuthenticated = window.bbai_ajax && window.bbai_ajax.is_authenticated === true;
if (isAuthenticated) {
clearInterval(checkInterval);
localStorage.removeItem('bbai_open_portal_after_login');
sessionStorage.setItem('bbai_portal_after_login', 'true');
setTimeout(function() {
openCustomerPortal();
setTimeout(function() {
sessionStorage.removeItem('bbai_portal_after_login');
}, 2000);
}, 300);
} else if (checkCount >= maxChecks) {
clearInterval(checkInterval);
localStorage.removeItem('bbai_open_portal_after_login');
console.warn('[AltText AI] User not authenticated after multiple checks');
}
}, 200);
}
}
/**
* Open Stripe payment link
*/
function openStripeLink(url) {
if (alttextaiDebug) console.log('[AltText AI] Opening Stripe link:', url);
window.open(url, '_blank');
}
window.openCustomerPortal = openCustomerPortal;
window.checkPortalAfterLogin = checkPortalAfterLogin;
window.openStripeLink = openStripeLink;
/* ============================================
* checkout.js
* ============================================ */
/**
* Checkout Integration
* Stripe checkout session handling
*
* @package BeepBeep_AI
* @since 5.0.0
*/
/**
* Initiate checkout session
*/
function initiateCheckout($btn, priceId, plan) {
var $ = window.jQuery || window.$;
if (typeof $ !== 'function') return;
if (alttextaiDebug) console.log('[AltText AI] Initiating checkout:', plan, priceId);
if (!window.bbai_ajax || !window.bbai_ajax.ajaxurl) {
if (window.bbaiModal) {
window.bbaiModal.error('Configuration error. Please refresh the page.');
}
return;
}
var originalText = $btn.text();
$btn.prop('disabled', true)
.addClass('bbai-btn-loading')
.html('<span class="bbai-spinner"></span> Processing...');
$.ajax({
url: window.bbai_ajax.ajaxurl,
type: 'POST',
data: {
action: 'beepbeepai_create_checkout',
nonce: window.bbai_ajax.nonce,
price_id: priceId,
plan: plan
},
timeout: 30000,
success: function(response) {
if (response.success && response.data && response.data.url) {
if (alttextaiDebug) console.log('[AltText AI] Checkout URL received, opening in new window:', response.data.url);
window.open(response.data.url, '_blank', 'noopener,noreferrer');
} else {
$btn.prop('disabled', false)
.removeClass('bbai-btn-loading')
.text(originalText);
var errorMsg = response.data?.message || 'Could not initiate checkout. Please try again.';
var fallbackUrl = $btn.attr('data-fallback-url');
if (fallbackUrl) {
if (alttextaiDebug) console.log('[AltText AI] Checkout API failed, using fallback URL:', fallbackUrl);
window.open(fallbackUrl, '_blank', 'noopener,noreferrer');
return;
}
if (response.data?.code === 'not_authenticated' || errorMsg.toLowerCase().includes('log in')) {
if (typeof showAuthModal === 'function') {
showAuthModal('login');
}
} else if (window.bbaiModal) {
window.bbaiModal.error(errorMsg);
}
}
},
error: function(xhr, status, error) {
$btn.prop('disabled', false)
.removeClass('bbai-btn-loading')
.text(originalText);
if (alttextaiDebug) console.error('[AltText AI] Checkout error:', status, error);
var fallbackUrl = $btn.attr('data-fallback-url');
if (fallbackUrl) {
if (alttextaiDebug) console.log('[AltText AI] Checkout AJAX failed, using fallback URL:', fallbackUrl);
window.open(fallbackUrl, '_blank', 'noopener,noreferrer');
return;
}
var errorMessage = 'Unable to initiate checkout. Please try again.';
if (status === 'timeout') {
errorMessage = 'Request timed out. Please try again.';
} else if (xhr.status === 401 || xhr.status === 403) {
errorMessage = 'Please log in to continue with checkout.';
if (typeof showAuthModal === 'function') {
showAuthModal('login');
}
}
if (window.bbaiModal) {
window.bbaiModal.error(errorMessage);
}
}
});
}
window.initiateCheckout = initiateCheckout;
/* ============================================
* countdown.js
* ============================================ */
/**
* Countdown Timer
* Usage limit reset countdown
*
* @package BeepBeep_AI
* @since 5.0.0
*/
/**
* Initialize and update countdown timer for limit reset
*/
function initCountdownTimer() {
var countdownElement = document.querySelector('.bbai-countdown[data-countdown]');
if (!countdownElement) {
if (alttextaiDebug) console.log('[AltText AI] Countdown element not found');
return;
}
var totalSeconds = parseInt(countdownElement.getAttribute('data-countdown'), 10) || 0;
if (totalSeconds <= 0) {
if (alttextaiDebug) console.log('[AltText AI] Countdown has zero or invalid seconds:', totalSeconds);
return;
}
var daysEl = countdownElement.querySelector('[data-days]');
var hoursEl = countdownElement.querySelector('[data-hours]');
var minutesEl = countdownElement.querySelector('[data-minutes]');
if (!daysEl || !hoursEl || !minutesEl) {
if (alttextaiDebug) console.warn('[AltText AI] Countdown elements not found');
return;
}
countdownElement.setAttribute('data-initial-seconds', totalSeconds.toString());
countdownElement.setAttribute('data-start-time', (Date.now() / 1000).toString());
if (alttextaiDebug) {
console.log('[AltText AI] Countdown initialized:', {
totalSeconds: totalSeconds,
days: Math.floor(totalSeconds / 86400),
hours: Math.floor((totalSeconds % 86400) / 3600),
minutes: Math.floor((totalSeconds % 3600) / 60)
});
}
function updateCountdown() {
var resetTimestamp = parseInt(countdownElement.getAttribute('data-reset-timestamp'), 10) || 0;
var remaining = 0;
if (resetTimestamp > 0) {
var currentTime = Math.floor(Date.now() / 1000);
remaining = Math.max(0, resetTimestamp - currentTime);
} else {
var initialSeconds = parseInt(countdownElement.getAttribute('data-initial-seconds'), 10) || 0;
if (initialSeconds <= 0) {
daysEl.textContent = '0';
hoursEl.textContent = '0';
minutesEl.textContent = '0';
if (window.alttextaiCountdownInterval) {
clearInterval(window.alttextaiCountdownInterval);
window.alttextaiCountdownInterval = null;
}
return;
}
var startTime = parseFloat(countdownElement.getAttribute('data-start-time')) || (Date.now() / 1000);
var currentTime = Date.now() / 1000;
var elapsed = Math.max(0, Math.floor(currentTime - startTime));
remaining = Math.max(0, initialSeconds - elapsed);
}
if (remaining <= 0) {
daysEl.textContent = '0';
hoursEl.textContent = '0';
minutesEl.textContent = '0';
countdownElement.setAttribute('data-countdown', '0');
if (window.alttextaiCountdownInterval) {
clearInterval(window.alttextaiCountdownInterval);
window.alttextaiCountdownInterval = null;
}
return;
}
var days = Math.floor(remaining / 86400);
var hours = Math.floor((remaining % 86400) / 3600);
var minutes = Math.floor((remaining % 3600) / 60);
daysEl.textContent = days.toString();
hoursEl.textContent = hours.toString();
minutesEl.textContent = minutes.toString();
countdownElement.setAttribute('data-countdown', remaining);
}
updateCountdown();
if (window.alttextaiCountdownInterval) {
clearInterval(window.alttextaiCountdownInterval);
}
window.alttextaiCountdownInterval = setInterval(function() {
updateCountdown();
}, 1000);
}
window.initCountdownTimer = initCountdownTimer;
/* ============================================
* library.js
* ============================================ */
/**
* Library Search and Filter
* Search and filter functionality for alt text library
*
* @package BeepBeep_AI
* @since 5.0.0
*/
bbaiRunWithJQuery(function($) {
'use strict';
$(document).ready(function() {
$('#bbai-library-search').on('input', function() {
var searchTerm = $(this).val().toLowerCase();
filterLibraryRows(searchTerm, getActiveFilter());
});
$('.bbai-filter-btn').on('click', function() {
var $btn = $(this);
var filter = $btn.attr('data-filter');
if ($btn.hasClass('active')) {
$btn.removeClass('active');
filterLibraryRows($('#bbai-library-search').val().toLowerCase(), null);
} else {
$('.bbai-filter-btn').removeClass('active');
$btn.addClass('active');
filterLibraryRows($('#bbai-library-search').val().toLowerCase(), filter);
}
});
/**
* Get currently active filter
*/
function getActiveFilter() {
var $activeBtn = $('.bbai-filter-btn.active');
return $activeBtn.length ? $activeBtn.attr('data-filter') : null;
}
/**
* Filter library table rows
*/
function filterLibraryRows(searchTerm, filter) {
var visibleCount = 0;
$('.bbai-library-row').each(function() {
var $row = $(this);
var status = $row.attr('data-status');
var rowText = $row.text().toLowerCase();
var matchesSearch = !searchTerm || rowText.includes(searchTerm);
var matchesFilter = true;
if (filter) {
if (filter === 'missing') {
matchesFilter = status === 'missing';
} else if (filter === 'has-alt') {
matchesFilter = status === 'optimized' || status === 'regenerated';
} else if (filter === 'regenerated') {
matchesFilter = status === 'regenerated';
} else if (filter === 'recent') {
matchesFilter = true;
}
}
if (matchesSearch && matchesFilter) {
$row.show();
visibleCount++;
} else {
$row.hide();
}
});
if (visibleCount === 0 && $('.bbai-library-table tbody tr').length > 1) {
console.log('[AltText AI] No matching rows found');
}
}
});
/**
* Character Counter for alt text
*/
window.bbaiCharCounter = {
create: function(text, options) {
options = options || {};
var charCount = text ? text.length : 0;
var maxChars = options.maxChars || 125;
var isOptimal = charCount <= maxChars;
var isEmpty = charCount === 0;
var stateClass = isEmpty ? 'bbai-char-counter--empty' :
(isOptimal ? 'bbai-char-counter--optimal' : 'bbai-char-counter--warning');
var icon = isEmpty ? '' :
(isOptimal ?
'<svg class="bbai-char-counter__icon" viewBox="0 0 12 12" fill="none"><circle cx="6" cy="6" r="5" stroke="currentColor" stroke-width="1.5" fill="none"/><path d="M3.5 6L5.5 8L8.5 4" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/></svg>' :
'<svg class="bbai-char-counter__icon" viewBox="0 0 12 12" fill="none"><circle cx="6" cy="6" r="5" stroke="currentColor" stroke-width="1.5" fill="none"/><path d="M6 3v3.5M6 8.5v.5" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/></svg>');
var message = isEmpty ? 'No alt text' :
(isOptimal ? 'Optimal for SEO' : 'Too long for optimal SEO');
var tooltip = isEmpty ? 'Add alt text for SEO' :
(isOptimal ?
'Alt text length is optimal for Google Images (â‰¤125 characters recommended)' :
'Consider shortening to 125 characters or less for optimal Google Images SEO');
return '<span class="bbai-char-counter ' + stateClass + '" title="' + tooltip + '">' +
icon +
'<span class="bbai-char-counter__number">' + charCount + '</span>' +
'<span class="bbai-char-counter__label">/' + maxChars + '</span>' +
'</span>';
},
init: function() {
$('.bbai-library-alt-text').each(function() {
var $altText = $(this);
var text = $altText.text().trim();
if ($altText.next('.bbai-char-counter').length === 0) {
var counterHTML = window.bbaiCharCounter.create(text);
$altText.after(counterHTML);
}
});
},
update: function($element, newText) {
var $counter = $element.next('.bbai-char-counter');
if ($counter.length) {
var newCounterHTML = this.create(newText);
$counter.replaceWith(newCounterHTML);
$element.next('.bbai-char-counter').addClass('bbai-char-counter--updating');
setTimeout(function() {
$element.next('.bbai-char-counter').removeClass('bbai-char-counter--updating');
}, 300);
}
}
};
$(document).ready(function() {
if (typeof window.bbaiCharCounter !== 'undefined') {
window.bbaiCharCounter.init();
}
$(document).on('bbai:alttext:updated', function() {
if (typeof window.bbaiCharCounter !== 'undefined') {
window.bbaiCharCounter.init();
}
});
});
});
/* ============================================
* seo-checker.js
* ============================================ */
/**
* SEO Quality Checker
* Validates alt text quality for SEO best practices
*
* @package BeepBeep_AI
* @since 5.0.0
*/
window.bbaiSEOChecker = {
/**
* Check if alt text starts with redundant phrases
*/
hasRedundantPrefix: function(text) {
if (!text) return false;
var lowerText = text.toLowerCase().trim();
var redundantPrefixes = [
'image of',
'picture of',
'photo of',
'photograph of',
'graphic of',
'illustration of',
'image showing',
'picture showing',
'photo showing'
];
return redundantPrefixes.some(function(prefix) {
return lowerText.startsWith(prefix);
});
},
/**
* Check if alt text is just a filename
*/
isJustFilename: function(text) {
if (!text) return false;
var filenamePatterns = [
/^IMG[-_]\d+/i,
/^DSC[-_]\d+/i,
/^\d{8}[-_]\d+/i,
/^screenshot[-_]/i,
/^image[-_]\d+/i,
/\.(jpg|jpeg|png|gif|webp)$/i
];
return filenamePatterns.some(function(pattern) {
return pattern.test(text.trim());
});
},
/**
* Check if alt text has meaningful content
*/
hasDescriptiveContent: function(text) {
if (!text) return false;
var words = text.trim().split(/\s+/);
return words.length >= 3 && words.some(function(word) {
return word.length > 3;
});
},
/**
* Calculate SEO quality score
*/
calculateQuality: function(text) {
var issues = [];
var score = 100;
if (!text || text.trim().length === 0) {
return {
score: 0,
grade: 'F',
issues: ['No alt text provided'],
badge: 'missing'
};
}
if (text.length > 125) {
issues.push('Too long (>' + text.length + ' chars). Aim for â‰¤125 for optimal Google Images SEO');
score -= 25;
}
if (this.hasRedundantPrefix(text)) {
issues.push('Starts with "image of" or similar. Remove redundant prefix');
score -= 20;
}
if (this.isJustFilename(text)) {
issues.push('Appears to be a filename. Use descriptive text instead');
score -= 30;
}
if (!this.hasDescriptiveContent(text)) {
issues.push('Too short or lacks descriptive keywords');
score -= 15;
}
var grade = 'F';
var badge = 'needs-work';
if (score >= 90) {
grade = 'A';
badge = 'excellent';
} else if (score >= 75) {
grade = 'B';
badge = 'good';
} else if (score >= 60) {
grade = 'C';
badge = 'fair';
} else if (score >= 40) {
grade = 'D';
badge = 'poor';
}
return {
score: Math.max(0, score),
grade: grade,
issues: issues,
badge: badge
};
},
/**
* Create SEO quality badge HTML
*/
createBadge: function(text) {
var quality = this.calculateQuality(text);
if (quality.badge === 'missing') {
return '';
}
var badgeClass = 'bbai-seo-badge bbai-seo-badge--' + quality.badge;
var icon = quality.grade === 'A' ?
'<svg width="10" height="10" viewBox="0 0 10 10" fill="none"><path d="M1 5l3 3 5-6" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/></svg>' :
quality.grade === 'B' ?
'<svg width="10" height="10" viewBox="0 0 10 10" fill="none"><circle cx="5" cy="5" r="4" stroke="currentColor" stroke-width="1.5" fill="none"/><path d="M5 2v3" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/></svg>' :
'<svg width="10" height="10" viewBox="0 0 10 10" fill="none"><path d="M2 2l6 6M2 8l6-6" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/></svg>';
var tooltip = quality.issues.length > 0 ?
'SEO Quality: ' + quality.grade + ' (' + quality.score + '/100)\n' + quality.issues.join('\n') :
'SEO Quality: ' + quality.grade + ' (' + quality.score + '/100) - Excellent!';
return '<span class="' + badgeClass + '" title="' + tooltip.replace(/"/g, '&quot;') + '">' +
icon +
'SEO: ' + quality.grade +
'</span>';
},
/**
* Initialize SEO quality badges
*/
init: function() {
var self = this;
var $ = window.jQuery || window.$;
if (typeof $ !== 'function') return;
$('.bbai-library-alt-text').each(function() {
var $altText = $(this);
var text = $altText.attr('data-full-text') || $altText.text().trim();
if ($altText.parent().find('.bbai-seo-badge').length === 0) {
var badgeHTML = self.createBadge(text);
if (badgeHTML) {
var $counter = $altText.next('.bbai-char-counter');
if ($counter.length) {
$counter.after(badgeHTML);
}
}
}
});
}
};
bbaiRunWithJQuery(function($) {
$(document).ready(function() {
if (typeof window.bbaiSEOChecker !== 'undefined') {
window.bbaiSEOChecker.init();
}
$(document).on('bbai:alttext:updated', function() {
if (typeof window.bbaiSEOChecker !== 'undefined') {
window.bbaiSEOChecker.init();
}
});
});
});
/* ============================================
* init.js
* ============================================ */
/**
* Dashboard Initialization
* Main entry point for dashboard functionality
*
* @package BeepBeep_AI
* @since 5.0.0
*/
bbaiRunWithJQuery(function($) {
'use strict';
var FALLBACK_UPGRADE_SELECTOR = [
'.bbai-upgrade-link',
'.bbai-upgrade-inline',
'.bbai-upgrade-cta-card button',
'.bbai-upgrade-cta-card a',
'.bbai-pro-upsell-card button',
'.bbai-upgrade-banner button',
'.bbai-upgrade-banner a',
'.bbai-hero-actions [data-cta="upgrade"]',
'.bbai-upgrade-callout button',
'.bbai-upgrade-callout a',
'[data-upgrade-trigger="true"]'
].join(', ');
function showUpgradeModal() {
var modal = document.getElementById('bbai-upgrade-modal');
if (modal) {
modal.classList.add('active');
modal.classList.add('is-visible');
modal.removeAttribute('style');
modal.style.cssText = 'display: flex !important; z-index: 999999 !important; position: fixed !important; inset: 0 !important; background-color: rgba(0,0,0,0.6) !important; align-items: center !important; justify-content: center !important; visibility: visible !important; opacity: 1 !important;';
modal.removeAttribute('aria-hidden');
document.body.style.overflow = 'hidden';
setTimeout(function() {
var closeBtn = modal.querySelector('.bbai-modal-close, [data-action="close-modal"], button');
if (closeBtn && typeof closeBtn.focus === 'function') {
closeBtn.focus();
}
}, 10);
return true;
}
return false;
}
function bindFallbackUpgradeTriggers() {
$(document).on('click', FALLBACK_UPGRADE_SELECTOR, function(e) {
if ($(this).is('[data-action="show-upgrade-modal"]')) {
return;
}
e.preventDefault();
e.stopPropagation();
if (alttextaiDebug) console.log('[AltText AI] Fallback upgrade trigger clicked');
if (!showUpgradeModal()) {
if (typeof window.openPricingModal === 'function') {
window.openPricingModal('enterprise');
}
}
return false;
});
}
function ensureUpgradeAttributes() {
$(FALLBACK_UPGRADE_SELECTOR).each(function() {
var $el = $(this);
if (!$el.attr('data-action')) {
$el.attr('data-action', 'show-upgrade-modal');
}
});
}
function observeFutureUpgradeTriggers() {
if (typeof MutationObserver === 'undefined') return;
var observer = new MutationObserver(function(mutations) {
mutations.forEach(function(mutation) {
if (mutation.type === 'childList' && mutation.addedNodes.length > 0) {
mutation.addedNodes.forEach(function(node) {
if (node.nodeType === 1) {
var $node = $(node);
if ($node.is(FALLBACK_UPGRADE_SELECTOR)) {
if (!$node.attr('data-action')) {
$node.attr('data-action', 'show-upgrade-modal');
}
}
$node.find(FALLBACK_UPGRADE_SELECTOR).each(function() {
if (!$(this).attr('data-action')) {
$(this).attr('data-action', 'show-upgrade-modal');
}
});
}
});
}
});
});
observer.observe(document.body, {
childList: true,
subtree: true
});
}
function bindDirectUpgradeHandlers() {
var directSelectors = [
'.bbai-upgrade-cta-card button',
'.bbai-upgrade-cta-card a',
'.bbai-pro-upsell-card button'
];
directSelectors.forEach(function(selector) {
$(document).on('click', selector, function(e) {
if ($(this).is('[data-action="show-upgrade-modal"]')) {
return;
}
e.preventDefault();
e.stopPropagation();
if (alttextaiDebug) console.log('[AltText AI] Direct upgrade handler fired for:', selector);
if (!showUpgradeModal()) {
if (typeof window.openPricingModal === 'function') {
window.openPricingModal('enterprise');
}
}
return false;
});
});
}
function handleManageSubscription($btn) {
if ($btn.hasClass('bbai-processing') || $btn.prop('disabled')) {
return false;
}
$btn.addClass('bbai-processing').prop('disabled', true);
var ajaxAuth = window.bbai_ajax && window.bbai_ajax.is_authenticated === true;
var userDataAuth = window.bbai_ajax && window.bbai_ajax.user_data && Object.keys(window.bbai_ajax.user_data).length > 0;
var isAdminTab = $('.bbai-admin-content').length > 0;
var isAuthenticated = ajaxAuth || userDataAuth || isAdminTab;
setTimeout(function() {
$btn.removeClass('bbai-processing').prop('disabled', false);
}, 1000);
if (!isAuthenticated) {
localStorage.setItem('bbai_open_portal_after_login', 'true');
if (typeof window.authModal !== 'undefined' && window.authModal && typeof window.authModal.show === 'function') {
window.authModal.show();
if (typeof window.authModal.showLoginForm === 'function') {
window.authModal.showLoginForm();
}
} else if (typeof showAuthModal === 'function') {
showAuthModal('login');
} else {
var authModal = document.getElementById('alttext-auth-modal');
if (authModal) {
authModal.style.display = 'block';
authModal.setAttribute('aria-hidden', 'false');
document.body.style.overflow = 'hidden';
} else {
window.bbaiModal.warning('Please log in first to manage your subscription.');
}
}
return false;
}
openCustomerPortal();
}
function handleLogoutAction($button) {
if (!window.bbai_ajax || !window.bbai_ajax.ajaxurl) {
window.bbaiModal.error('Configuration error. Please refresh the page.');
return;
}
$button.prop('disabled', true)
.addClass('bbai-btn-loading')
.attr('aria-busy', 'true');
var originalText = $button.text();
$button.html('<span class="bbai-spinner"></span> Logging out...');
$.ajax({
url: window.bbai_ajax.ajaxurl,
type: 'POST',
data: {
action: 'beepbeepai_logout',
nonce: window.bbai_ajax.nonce
},
timeout: 15000,
success: function(response) {
if (response.success) {
$button.removeClass('bbai-btn-loading')
.html('<span class="dashicons dashicons-yes"></span> Logged out');
setTimeout(function() {
window.location.reload();
}, 500);
} else {
$button.prop('disabled', false)
.removeClass('bbai-btn-loading')
.attr('aria-busy', 'false')
.text(originalText);
window.bbaiModal.error(response.data?.message || 'Logout failed. Please try again.');
}
},
error: function() {
$button.prop('disabled', false)
.removeClass('bbai-btn-loading')
.attr('aria-busy', 'false')
.text(originalText);
window.bbaiModal.error('Unable to log out. Please try again.');
}
});
}
function disconnectAccount($button) {
if (!window.bbai_ajax || !window.bbai_ajax.ajaxurl) {
window.bbaiModal.error('Configuration error. Please refresh the page.');
return;
}
$button.prop('disabled', true).addClass('bbai-btn-loading');
var originalText = $button.text();
$button.html('<span class="bbai-spinner"></span> Disconnecting...');
$.ajax({
url: window.bbai_ajax.ajaxurl,
type: 'POST',
data: {
action: 'beepbeepai_disconnect_account',
nonce: window.bbai_ajax.nonce
},
timeout: 15000,
success: function(response) {
if (response.success) {
window.bbaiModal.success('Account disconnected. Refreshing...');
setTimeout(function() {
window.location.reload();
}, 1000);
} else {
$button.prop('disabled', false)
.removeClass('bbai-btn-loading')
.text(originalText);
window.bbaiModal.error(response.data?.message || 'Failed to disconnect. Please try again.');
}
},
error: function() {
$button.prop('disabled', false)
.removeClass('bbai-btn-loading')
.text(originalText);
window.bbaiModal.error('Unable to disconnect. Please try again.');
}
});
}
$(document).ready(function() {
if (alttextaiDebug) console.log('[AltText AI] Dashboard initializing');
setTimeout(function() {
if (typeof loadLicenseSiteUsage === 'function') {
loadLicenseSiteUsage();
}
}, 500);
checkPortalAfterLogin();
if (typeof initCountdownTimer === 'function') {
initCountdownTimer();
}
bindFallbackUpgradeTriggers();
ensureUpgradeAttributes();
observeFutureUpgradeTriggers();
bindDirectUpgradeHandlers();
$(document).on('click', '[data-action="show-upgrade-modal"]', function(e) {
e.preventDefault();
e.stopPropagation();
if (!showUpgradeModal()) {
if (typeof window.openPricingModal === 'function') {
window.openPricingModal('enterprise');
} else if (typeof bbaiApp !== 'undefined' && typeof bbaiApp.showModal === 'function') {
bbaiApp.showModal();
} else if (typeof alttextaiShowModal === 'function') {
alttextaiShowModal();
} else {
if (typeof window.bbaiModal !== 'undefined') {
window.bbaiModal.warning('Upgrade modal not found. Please refresh the page.');
}
}
}
return false;
});
$(document).on('click', '#bbai-show-auth-banner-btn', function(e) {
e.preventDefault();
if (typeof showAuthBanner === 'function') {
showAuthBanner();
}
});
$(document).on('click', '#bbai-show-auth-login-btn', function(e) {
e.preventDefault();
if (typeof showAuthLogin === 'function') {
showAuthLogin();
}
});
$(document).on('click', '#bbai-logout-btn', function(e) {
e.preventDefault();
e.stopPropagation();
if (typeof handleLogout === 'function') {
handleLogout();
}
});
$(document).on('click', '[data-action="show-auth-modal"]', function(e) {
e.preventDefault();
var authTab = $(this).attr('data-auth-tab') || 'login';
if (typeof showAuthModal === 'function') {
showAuthModal(authTab);
}
});
$(document).on('click', '[data-action="open-billing-portal"]', function(e) {
e.preventDefault();
var isAuthenticated = window.bbai_ajax && window.bbai_ajax.is_authenticated;
if (isAuthenticated) {
openCustomerPortal();
} else {
localStorage.setItem('bbai_open_portal_after_login', 'true');
if (typeof showAuthModal === 'function') {
showAuthModal('login');
}
}
});
$(document).on('click', '#bbai-demo-signup-btn, #bbai-settings-signup-btn', function(e) {
e.preventDefault();
if (typeof showAuthLogin === 'function') {
showAuthLogin();
}
});
if ($('#bbai-account-management').length) {
if (typeof loadSubscriptionInfo === 'function') {
loadSubscriptionInfo();
}
}
$(document).on('click', '#bbai-update-payment-method, #bbai-manage-subscription', function(e) {
e.preventDefault();
handleManageSubscription($(this));
});
$(document).on('click', '[data-action="manage-subscription"]', function(e) {
e.preventDefault();
e.stopPropagation();
handleManageSubscription($(this));
});
$(document).on('click', '[data-action="disconnect-account"]', function(e) {
e.preventDefault();
if (!confirm('Disconnect this account for all WordPress users? You can reconnect at any time.')) {
return;
}
disconnectAccount($(this));
});
$(document).on('click', '[data-action="logout"]', function(e) {
e.preventDefault();
handleLogoutAction($(this));
});
if (alttextaiDebug) console.log('[AltText AI] Dashboard initialized');
});
});