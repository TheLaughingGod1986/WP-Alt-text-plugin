<<<<<<< HEAD
function alttextaiShowModal(){const t=document.getElementById("alttextai-upgrade-modal");t&&(t.style.display="flex")}function alttextaiCloseModal(){const t=document.getElementById("alttextai-upgrade-modal");t&&(t.style.display="none")}!function(t){"use strict";var e={};function a(a){return e[a]||(e[a]=t(a)),e[a]}function o(e){const c=a("#alttextai-subscription-loading"),u=a("#alttextai-subscription-error"),d=a("#alttextai-subscription-info"),x=a("#alttextai-free-plan-message");if(!e){const t=function(){try{const t=localStorage.getItem("alttextai_subscription_cache");if(!t)return null;const e=JSON.parse(t);return Date.now()-e.timestamp<e.expiry?e:(localStorage.removeItem("alttextai_subscription_cache"),null)}catch(t){return console.warn("[AltText AI] Could not read subscription cache:",t),null}}();if(t)return void n(t.data)}c.show(),u.hide(),d.hide(),x.hide(),window.alttextai_ajax&&window.alttextai_ajax.ajaxurl?t.ajax({url:window.alttextai_ajax.ajaxurl,type:"POST",data:{action:"alttextai_get_subscription_info",nonce:window.alttextai_ajax.nonce},success:function(t){if(c.hide(),t.success&&t.data){if(i=0,r&&(clearTimeout(r),r=null),function(t){try{const e={data:t,timestamp:Date.now(),expiry:9e5};localStorage.setItem("alttextai_subscription_cache",JSON.stringify(e))}catch(t){console.warn("[AltText AI] Could not cache subscription info:",t)}}(t.data),n(t.data),"success"===new URLSearchParams(window.location.search).get("portal_return")){const t=window.location.pathname+window.location.search.replace(/[?&]portal_return=success/,"").replace(/^&/,"?");t!==window.location.pathname+window.location.search&&window.history.replaceState({},document.title,t),setTimeout(function(){o(!0)},2e3)}}else if("free"===(t.data?.plan||"free"))x.show();else{let e=t.data?.message||"Failed to load subscription information.";e.toLowerCase().includes("not authenticated")||e.toLowerCase().includes("login")?e="Please log in to view your subscription information.":e.toLowerCase().includes("not found")&&(e="Subscription not found. If you just upgraded, please wait a moment and refresh."),s(e)}},error:function(e,a,n){c.hide();let u="Network error. Please try again.";return 401===e.status||403===e.status?(u="Please log in to view your subscription information.",void s(u)):404===e.status?(u="Subscription information not found. If you just signed up, please wait a moment and refresh.",void s(u)):e.status>=500||"timeout"===a||"error"===a?(u="Service temporarily unavailable. Retrying automatically...",s(u),void function(){if(i>=l)return s("Service unavailable after multiple attempts. Please try again later or refresh the page."),void(i=0);i++;const e=Math.min(1e3*Math.pow(2,i-1),16e3);t("#alttextai-subscription-error").find(".alttextai-error-message").text("Service temporarily unavailable. Retrying in "+Math.ceil(e/1e3)+" seconds... (Attempt "+i+"/"+l+")"),r&&clearTimeout(r),r=setTimeout(function(){o(!0)},e)}()):void s(u)}}):s("Configuration error. Please refresh the page.")}function n(t){const e=a("#alttextai-subscription-info"),o=a("#alttextai-subscription-error"),n=a("#alttextai-free-plan-message");if(o.hide(),n.hide(),!t.plan||"free"===t.plan||"free"===t.status)return void n.show();const i=t.status||"active",l=a("#alttextai-status-badge"),r=l.find(".alttextai-status-label");l.removeClass("alttextai-status-active alttextai-status-cancelled alttextai-status-trial"),l.addClass("alttextai-status-"+i),r.text(i.charAt(0).toUpperCase()+i.slice(1));const s=a("#alttextai-cancel-warning");t.cancelAtPeriodEnd?s.show():s.hide();const c=t.plan?t.plan.charAt(0).toUpperCase()+t.plan.slice(1):"-";a("#alttextai-plan-name").text(c);const u=t.billingCycle?t.billingCycle.charAt(0).toUpperCase()+t.billingCycle.slice(1):"-";if(a("#alttextai-billing-cycle").text(u),t.nextBillingDate){const e=new Date(t.nextBillingDate);a("#alttextai-next-billing").text(e.toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"}))}else a("#alttextai-next-billing").text("-");if(void 0!==t.nextChargeAmount&&null!==t.nextChargeAmount){const e=t.currency||"GBP",o="USD"===e?"$":"EUR"===e?"â‚¬":"Â£";a("#alttextai-next-charge").text(o+parseFloat(t.nextChargeAmount).toFixed(2))}else a("#alttextai-next-charge").text("-");if(t.paymentMethod&&t.paymentMethod.last4){const e=a("#alttextai-payment-method"),o=t.paymentMethod.brand||"card",n=t.paymentMethod.last4,i=t.paymentMethod.expMonth,l=t.paymentMethod.expYear;a("#alttextai-card-brand").text(function(t){return{visa:"ðŸ’³",mastercard:"ðŸ’³",amex:"ðŸ’³",discover:"ðŸ’³",diners:"ðŸ’³",jcb:"ðŸ’³",unionpay:"ðŸ’³"}[t.toLowerCase()]||"ðŸ’³"}(o)+" "+o.toUpperCase()),a("#alttextai-card-last4").text("â€¢â€¢â€¢â€¢ "+n),i&&l&&a("#alttextai-card-expiry").text(i+"/"+l.toString().slice(-2)),e.show()}else a("#alttextai-payment-method").hide();e.show()}t(document).ready(function(){t(document).on("click",'[data-action="show-upgrade-modal"]',function(t){t.preventDefault();try{var e=!1;if(void 0!==window.alttextai_ajax&&void 0!==window.alttextai_ajax.is_authenticated&&(e=!!window.alttextai_ajax.is_authenticated),!e)return void showAuthLogin();alttextaiShowModal()}catch(t){alttextaiShowModal()}}),t(document).on("click","#alttextai-show-auth-banner-btn, #alttextai-show-auth-banner-btn-cta",function(t){t.preventDefault(),showAuthBanner()}),t(document).on("click","#alttextai-show-auth-login-btn",function(t){t.preventDefault(),showAuthLogin()}),t(document).on("click","#alttextai-logout-btn",function(t){t.preventDefault(),t.stopPropagation(),handleLogout()}),t(document).on("click",'[data-action="open-billing-portal"]',function(t){t.preventDefault()}),t(document).on("click","#alttextai-demo-signup-btn, #alttextai-settings-signup-btn",function(t){t.preventDefault(),showAuthLogin()}),t("#alttextai-account-management").length&&o(),t(document).on("click","#alttextai-update-payment-method, #alttextai-manage-subscription",function(e){e.preventDefault(),function(){if(!window.alttextai_ajax||!window.alttextai_ajax.ajaxurl)return void alert("Configuration error. Please refresh the page.");const e=t("#alttextai-update-payment-method, #alttextai-manage-subscription");e.prop("disabled",!0),t.ajax({url:window.alttextai_ajax.ajaxurl,type:"POST",data:{action:"alttextai_create_portal",nonce:window.alttextai_ajax.nonce},success:function(t){if(e.prop("disabled",!1),t.success&&t.data&&t.data.url){window.open(t.data.url,"_blank");let e=0;const a=150,n=setInterval(function(){if(e++,document.hasFocus()||e>=a){clearInterval(n),o();const t=new URL(window.location);t.searchParams.set("portal_return","success"),window.history.replaceState({},document.title,t.toString())}},2e3)}else{let e=t.data?.message||"Failed to open customer portal. Please try again.";e.toLowerCase().includes("not authenticated")||e.toLowerCase().includes("login")?e="Please log in to manage your billing.":(e.toLowerCase().includes("not found")||e.toLowerCase().includes("subscription"))&&(e="No active subscription found. Please upgrade first to manage billing."),alert(e)}},error:function(t,a,o){e.prop("disabled",!1),alert("Network error. Please try again.")}})}()}),t(document).on("click","#alttextai-retry-subscription",function(t){t.preventDefault(),o(!0)})});let i=0;const l=5;let r=null;function s(e){const a=t("#alttextai-subscription-error"),o=t("#alttextai-subscription-info"),n=t("#alttextai-free-plan-message");a.find(".alttextai-error-message").text(e),a.show(),o.hide(),n.hide()}}(jQuery);var alttextaiDebug=void 0!==window.alttextai_ajax&&window.alttextai_ajax.debug||!1;function openStripeLink(t){alttextaiDebug&&console.log("[AltText AI] Opening Stripe link:",t),window.open(t,"_blank")}function showAuthBanner(){if(alttextaiDebug&&console.log("[AltText AI] Showing auth banner"),void 0!==window.authModal&&window.authModal&&"function"==typeof window.authModal.show)alttextaiDebug&&console.log("[AltText AI] Using authModal.show()"),window.authModal.show();else{const t=document.getElementById("alttext-auth-modal");t?(alttextaiDebug&&console.log("[AltText AI] Showing auth modal directly"),t.style.display="block"):(alttextaiDebug&&console.log("[AltText AI] Auth modal not found"),alert("Authentication system not available. Please refresh the page."))}}function showAuthLogin(){return alttextaiDebug&&console.log("[AltText AI] Showing auth login"),void 0!==window.AltTextAuthModal&&window.AltTextAuthModal&&"function"==typeof window.AltTextAuthModal.show?(alttextaiDebug&&console.log("[AltText AI] Using AltTextAuthModal.show()"),void window.AltTextAuthModal.show()):void 0!==window.authModal&&window.authModal&&"function"==typeof window.authModal.show?(alttextaiDebug&&console.log("[AltText AI] Using authModal.show()"),void window.authModal.show()):void showAuthBanner()}function handleLogout(){if(alttextaiDebug&&console.log("[AltText AI] Handling logout"),void 0===window.alttextai_ajax)return console.error("[AltText AI] alttextai_ajax object not found"),"undefined"!=typeof localStorage&&localStorage.removeItem("alttextai_token"),void window.location.reload();const t=window.alttextai_ajax.ajax_url||window.alttextai_ajax.ajaxurl||ajaxurl,e=window.alttextai_ajax.nonce||"";if(!t)return console.error("[AltText AI] AJAX URL not found"),void window.location.reload();if(alttextaiDebug&&console.log("[AltText AI] Calling logout AJAX:",t),"undefined"!=typeof jQuery&&jQuery.ajax)jQuery.ajax({url:t,type:"POST",data:{action:"alttextai_logout",nonce:e},success:function(t){alttextaiDebug&&console.log("[AltText AI] Logout successful",t),"undefined"!=typeof localStorage&&localStorage.removeItem("alttextai_token"),window.location.reload()},error:function(t,e,a){console.error("[AltText AI] Logout failed:",a,t.responseText),"undefined"!=typeof localStorage&&localStorage.removeItem("alttextai_token"),alert("Logged out locally. Refreshing page..."),window.location.reload()}});else{const a=new FormData;a.append("action","alttextai_logout"),a.append("nonce",e),fetch(t,{method:"POST",body:a,credentials:"same-origin"}).then(t=>(alttextaiDebug&&console.log("[AltText AI] Logout response status:",t.status),t.json().catch(()=>({})))).then(t=>{alttextaiDebug&&console.log("[AltText AI] Logout successful",t),"undefined"!=typeof localStorage&&localStorage.removeItem("alttextai_token"),window.location.reload()}).catch(t=>{console.error("[AltText AI] Logout failed:",t),"undefined"!=typeof localStorage&&localStorage.removeItem("alttextai_token"),alert("Logged out locally. Refreshing page..."),window.location.reload()})}}function initCountdownTimer(){const t=document.querySelector(".alttextai-countdown");if(!t)return;let e=parseInt(t.getAttribute("data-countdown"),10);if(!e||e<=0){const t=document.querySelector(".alttextai-limit-description");if(t){const a=(t.textContent||"").match(/([A-Za-z]+ \d{1,2}, \d{4})/);if(a){const t=new Date(a[1]),o=new Date;e=Math.max(0,Math.floor((t.getTime()-o.getTime())/1e3)),alttextaiDebug&&console.log("[AltText AI] Calculated countdown from date:",{resetDate:a[1],totalSeconds:e})}}}if(!e||e<=0){const t=new Date,a=new Date(t.getFullYear(),t.getMonth()+1,1);e=Math.max(0,Math.floor((a.getTime()-t.getTime())/1e3)),alttextaiDebug&&console.warn("[AltText AI] Using fallback countdown calculation:",e)}const a=t.querySelector("[data-days]"),o=t.querySelector("[data-hours]"),n=t.querySelector("[data-minutes]");if(!a||!o||!n)return void(alttextaiDebug&&console.warn("[AltText AI] Countdown elements not found"));function i(){const e=parseInt(t.getAttribute("data-initial-seconds"),10)||0,i=parseFloat(t.getAttribute("data-start-time"))||Date.now()/1e3,l=Date.now()/1e3,r=Math.floor(l-i);let s=Math.max(0,e-r);if(s<=0)return a.textContent="0",o.textContent="0",n.textContent="0",void t.setAttribute("data-countdown","0");const c=Math.floor(s/86400),u=Math.floor(s%86400/3600),d=Math.floor(s%3600/60);a.textContent=c.toString(),o.textContent=u.toString(),n.textContent=d.toString(),t.setAttribute("data-countdown",s.toString())}t.setAttribute("data-initial-seconds",e.toString()),t.setAttribute("data-start-time",(Date.now()/1e3).toString()),t.setAttribute("data-countdown",e.toString()),alttextaiDebug&&console.log("[AltText AI] Countdown initialized:",{totalSeconds:e,days:Math.floor(e/86400),hours:Math.floor(e%86400/3600),minutes:Math.floor(e%3600/60)}),i();const l=setInterval(function(){i(),(parseInt(t.getAttribute("data-countdown"),10)||0)<=0&&(clearInterval(l),r&&clearInterval(r))},6e4);let r=setInterval(function(){i(),(parseInt(t.getAttribute("data-countdown"),10)||0)<=0&&clearInterval(r)},1e3);t.dataset.intervalId=l,t.dataset.secondIntervalId=r}document.addEventListener("DOMContentLoaded",function(){alttextaiDebug&&console.log("[AltText AI] DOM loaded, initializing auth system");const t=document.getElementById("alttextai-logout-btn");if(t){const e=t.cloneNode(!0);t.parentNode.replaceChild(e,t),e.addEventListener("click",function(t){t.preventDefault(),t.stopPropagation(),alttextaiDebug&&console.log("[AltText AI] Logout button clicked (Vanilla JS)"),handleLogout()}),alttextaiDebug&&console.log("[AltText AI] Logout button found and listener attached")}else alttextaiDebug&&console.log("[AltText AI] Logout button not found");alttextaiDebug&&(document.getElementById("alttext-auth-modal")?console.log("[AltText AI] Auth modal found"):console.log("[AltText AI] Auth modal not found - may need to be created"),void 0!==window.authModal?console.log("[AltText AI] authModal object found"):console.log("[AltText AI] authModal object not found")),initCountdownTimer()});
=======
function alttextaiShowModal(){const t=document.getElementById("alttextai-upgrade-modal");t&&(t.style.display="flex")}function alttextaiCloseModal(){const t=document.getElementById("alttextai-upgrade-modal");t&&(t.style.display="none")}!function(t){"use strict";var e={};function a(a){return e[a]||(e[a]=t(a)),e[a]}function o(e){const u=a("#alttextai-subscription-loading"),c=a("#alttextai-subscription-error"),d=a("#alttextai-subscription-info"),x=a("#alttextai-free-plan-message");if(!e){const t=function(){try{const t=localStorage.getItem("alttextai_subscription_cache");if(!t)return null;const e=JSON.parse(t);return Date.now()-e.timestamp<e.expiry?e:(localStorage.removeItem("alttextai_subscription_cache"),null)}catch(t){return console.warn("[AltText AI] Could not read subscription cache:",t),null}}();if(t)return void n(t.data)}u.show(),c.hide(),d.hide(),x.hide(),window.alttextai_ajax&&window.alttextai_ajax.ajaxurl?t.ajax({url:window.alttextai_ajax.ajaxurl,type:"POST",data:{action:"alttextai_get_subscription_info",nonce:window.alttextai_ajax.nonce},success:function(t){if(u.hide(),t.success&&t.data){if(i=0,r&&(clearTimeout(r),r=null),function(t){try{const e={data:t,timestamp:Date.now(),expiry:9e5};localStorage.setItem("alttextai_subscription_cache",JSON.stringify(e))}catch(t){console.warn("[AltText AI] Could not cache subscription info:",t)}}(t.data),n(t.data),"success"===new URLSearchParams(window.location.search).get("portal_return")){const t=window.location.pathname+window.location.search.replace(/[?&]portal_return=success/,"").replace(/^&/,"?");t!==window.location.pathname+window.location.search&&window.history.replaceState({},document.title,t),setTimeout(function(){o(!0)},2e3)}}else if("free"===(t.data?.plan||"free"))x.show();else{let e=t.data?.message||"Failed to load subscription information.";e.toLowerCase().includes("not authenticated")||e.toLowerCase().includes("login")?e="Please log in to view your subscription information.":e.toLowerCase().includes("not found")&&(e="Subscription not found. If you just upgraded, please wait a moment and refresh."),s(e)}},error:function(e,a,n){u.hide();let c="Network error. Please try again.";return 401===e.status||403===e.status?(c="Please log in to view your subscription information.",void s(c)):404===e.status?(c="Subscription information not found. If you just signed up, please wait a moment and refresh.",void s(c)):e.status>=500||"timeout"===a||"error"===a?(c="Service temporarily unavailable. Retrying automatically...",s(c),void function(){if(i>=l)return s("Service unavailable after multiple attempts. Please try again later or refresh the page."),void(i=0);i++;const e=Math.min(1e3*Math.pow(2,i-1),16e3);t("#alttextai-subscription-error").find(".alttextai-error-message").text("Service temporarily unavailable. Retrying in "+Math.ceil(e/1e3)+" seconds... (Attempt "+i+"/"+l+")"),r&&clearTimeout(r),r=setTimeout(function(){o(!0)},e)}()):void s(c)}}):s("Configuration error. Please refresh the page.")}function n(t){const e=a("#alttextai-subscription-info"),o=a("#alttextai-subscription-error"),n=a("#alttextai-free-plan-message");if(o.hide(),n.hide(),!t.plan||"free"===t.plan||"free"===t.status)return void n.show();const i=t.status||"active",l=a("#alttextai-status-badge"),r=l.find(".alttextai-status-label");l.removeClass("alttextai-status-active alttextai-status-cancelled alttextai-status-trial"),l.addClass("alttextai-status-"+i),r.text(i.charAt(0).toUpperCase()+i.slice(1));const s=a("#alttextai-cancel-warning");t.cancelAtPeriodEnd?s.show():s.hide();const u=t.plan?t.plan.charAt(0).toUpperCase()+t.plan.slice(1):"-";a("#alttextai-plan-name").text(u);const c=t.billingCycle?t.billingCycle.charAt(0).toUpperCase()+t.billingCycle.slice(1):"-";if(a("#alttextai-billing-cycle").text(c),t.nextBillingDate){const e=new Date(t.nextBillingDate);a("#alttextai-next-billing").text(e.toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"}))}else a("#alttextai-next-billing").text("-");if(void 0!==t.nextChargeAmount&&null!==t.nextChargeAmount){const e=t.currency||"GBP",o="USD"===e?"$":"EUR"===e?"â‚¬":"Â£";a("#alttextai-next-charge").text(o+parseFloat(t.nextChargeAmount).toFixed(2))}else a("#alttextai-next-charge").text("-");if(t.paymentMethod&&t.paymentMethod.last4){const e=a("#alttextai-payment-method"),o=t.paymentMethod.brand||"card",n=t.paymentMethod.last4,i=t.paymentMethod.expMonth,l=t.paymentMethod.expYear;a("#alttextai-card-brand").text(function(t){return{visa:"ðŸ’³",mastercard:"ðŸ’³",amex:"ðŸ’³",discover:"ðŸ’³",diners:"ðŸ’³",jcb:"ðŸ’³",unionpay:"ðŸ’³"}[t.toLowerCase()]||"ðŸ’³"}(o)+" "+o.toUpperCase()),a("#alttextai-card-last4").text("â€¢â€¢â€¢â€¢ "+n),i&&l&&a("#alttextai-card-expiry").text(i+"/"+l.toString().slice(-2)),e.show()}else a("#alttextai-payment-method").hide();e.show()}t(document).ready(function(){t(document).on("click",'[data-action="show-upgrade-modal"]',function(t){t.preventDefault();try{var e=!1;if(void 0!==window.alttextai_ajax&&void 0!==window.alttextai_ajax.is_authenticated&&(e=!!window.alttextai_ajax.is_authenticated),!e)return void showAuthLogin();alttextaiShowModal()}catch(t){alttextaiShowModal()}}),t(document).on("click","#alttextai-show-auth-banner-btn",function(t){t.preventDefault(),showAuthBanner()}),t(document).on("click","#alttextai-show-auth-login-btn",function(t){t.preventDefault(),showAuthLogin()}),t(document).on("click","#alttextai-logout-btn",function(t){t.preventDefault(),t.stopPropagation(),handleLogout()}),t(document).on("click",'[data-action="open-billing-portal"]',function(t){t.preventDefault()}),t(document).on("click","#alttextai-demo-signup-btn, #alttextai-settings-signup-btn",function(t){t.preventDefault(),showAuthLogin()}),t("#alttextai-account-management").length&&o(),t(document).on("click","#alttextai-update-payment-method, #alttextai-manage-subscription",function(e){e.preventDefault(),function(){if(!window.alttextai_ajax||!window.alttextai_ajax.ajaxurl)return void alert("Configuration error. Please refresh the page.");const e=t("#alttextai-update-payment-method, #alttextai-manage-subscription");e.prop("disabled",!0),t.ajax({url:window.alttextai_ajax.ajaxurl,type:"POST",data:{action:"alttextai_create_portal",nonce:window.alttextai_ajax.nonce},success:function(t){if(e.prop("disabled",!1),t.success&&t.data&&t.data.url){window.open(t.data.url,"_blank");let e=0;const a=150,n=setInterval(function(){if(e++,document.hasFocus()||e>=a){clearInterval(n),o();const t=new URL(window.location);t.searchParams.set("portal_return","success"),window.history.replaceState({},document.title,t.toString())}},2e3)}else{let e=t.data?.message||"Failed to open customer portal. Please try again.";e.toLowerCase().includes("not authenticated")||e.toLowerCase().includes("login")?e="Please log in to manage your billing.":(e.toLowerCase().includes("not found")||e.toLowerCase().includes("subscription"))&&(e="No active subscription found. Please upgrade first to manage billing."),alert(e)}},error:function(t,a,o){e.prop("disabled",!1),alert("Network error. Please try again.")}})}()}),t(document).on("click","#alttextai-retry-subscription",function(t){t.preventDefault(),o(!0)})});let i=0;const l=5;let r=null;function s(e){const a=t("#alttextai-subscription-error"),o=t("#alttextai-subscription-info"),n=t("#alttextai-free-plan-message");a.find(".alttextai-error-message").text(e),a.show(),o.hide(),n.hide()}}(jQuery);var alttextaiDebug=void 0!==window.alttextai_ajax&&window.alttextai_ajax.debug||!1;function openStripeLink(t){alttextaiDebug&&console.log("[AltText AI] Opening Stripe link:",t),window.open(t,"_blank")}function showAuthBanner(){if(alttextaiDebug&&console.log("[AltText AI] Showing auth banner"),void 0!==window.authModal&&window.authModal&&"function"==typeof window.authModal.show)alttextaiDebug&&console.log("[AltText AI] Using authModal.show()"),window.authModal.show();else{const t=document.getElementById("alttext-auth-modal");t?(alttextaiDebug&&console.log("[AltText AI] Showing auth modal directly"),t.style.display="block"):(alttextaiDebug&&console.log("[AltText AI] Auth modal not found"),alert("Authentication system not available. Please refresh the page."))}}function showAuthLogin(){return alttextaiDebug&&console.log("[AltText AI] Showing auth login"),void 0!==window.AltTextAuthModal&&window.AltTextAuthModal&&"function"==typeof window.AltTextAuthModal.show?(alttextaiDebug&&console.log("[AltText AI] Using AltTextAuthModal.show()"),void window.AltTextAuthModal.show()):void 0!==window.authModal&&window.authModal&&"function"==typeof window.authModal.show?(alttextaiDebug&&console.log("[AltText AI] Using authModal.show()"),void window.authModal.show()):void showAuthBanner()}function handleLogout(){if(alttextaiDebug&&console.log("[AltText AI] Handling logout"),void 0===window.alttextai_ajax)return console.error("[AltText AI] alttextai_ajax object not found"),"undefined"!=typeof localStorage&&localStorage.removeItem("alttextai_token"),void window.location.reload();const t=window.alttextai_ajax.ajax_url||window.alttextai_ajax.ajaxurl||ajaxurl,e=window.alttextai_ajax.nonce||"";if(!t)return console.error("[AltText AI] AJAX URL not found"),void window.location.reload();if(alttextaiDebug&&console.log("[AltText AI] Calling logout AJAX:",t),"undefined"!=typeof jQuery&&jQuery.ajax)jQuery.ajax({url:t,type:"POST",data:{action:"alttextai_logout",nonce:e},success:function(t){alttextaiDebug&&console.log("[AltText AI] Logout successful",t),"undefined"!=typeof localStorage&&localStorage.removeItem("alttextai_token"),window.location.reload()},error:function(t,e,a){console.error("[AltText AI] Logout failed:",a,t.responseText),"undefined"!=typeof localStorage&&localStorage.removeItem("alttextai_token"),alert("Logged out locally. Refreshing page..."),window.location.reload()}});else{const a=new FormData;a.append("action","alttextai_logout"),a.append("nonce",e),fetch(t,{method:"POST",body:a,credentials:"same-origin"}).then(t=>(alttextaiDebug&&console.log("[AltText AI] Logout response status:",t.status),t.json().catch(()=>({})))).then(t=>{alttextaiDebug&&console.log("[AltText AI] Logout successful",t),"undefined"!=typeof localStorage&&localStorage.removeItem("alttextai_token"),window.location.reload()}).catch(t=>{console.error("[AltText AI] Logout failed:",t),"undefined"!=typeof localStorage&&localStorage.removeItem("alttextai_token"),alert("Logged out locally. Refreshing page..."),window.location.reload()})}}function initCountdownTimer(){const t=document.querySelector(".alttextai-countdown[data-countdown]");if(!t)return;const e=parseInt(t.getAttribute("data-countdown"),10)||0,a=t.querySelector("[data-days]"),o=t.querySelector("[data-hours]"),n=t.querySelector("[data-minutes]");if(!a||!o||!n)return void(alttextaiDebug&&console.warn("[AltText AI] Countdown elements not found"));function i(){const e=parseInt(t.getAttribute("data-initial-seconds"),10)||0,i=parseFloat(t.getAttribute("data-start-time"))||Date.now()/1e3,l=Date.now()/1e3,r=Math.floor(l-i);let s=Math.max(0,e-r);if(s<=0)return a.textContent="0",o.textContent="0",n.textContent="0",void t.setAttribute("data-countdown","0");const u=Math.floor(s/86400),c=Math.floor(s%86400/3600),d=Math.floor(s%3600/60);a.textContent=u.toString(),o.textContent=c.toString(),n.textContent=d.toString(),t.setAttribute("data-countdown",s)}t.setAttribute("data-initial-seconds",e.toString()),t.setAttribute("data-start-time",(Date.now()/1e3).toString()),alttextaiDebug&&console.log("[AltText AI] Countdown initialized:",{totalSeconds:e,days:Math.floor(e/86400),hours:Math.floor(e%86400/3600),minutes:Math.floor(e%3600/60)}),i();const l=setInterval(function(){i(),(parseInt(t.getAttribute("data-countdown"),10)||0)<=0&&clearInterval(l)},6e4),r=setInterval(function(){i(),(parseInt(t.getAttribute("data-countdown"),10)||0)<=60&&clearInterval(r)},1e3)}document.addEventListener("DOMContentLoaded",function(){alttextaiDebug&&console.log("[AltText AI] DOM loaded, initializing auth system");const t=document.getElementById("alttextai-logout-btn");if(t){const e=t.cloneNode(!0);t.parentNode.replaceChild(e,t),e.addEventListener("click",function(t){t.preventDefault(),t.stopPropagation(),alttextaiDebug&&console.log("[AltText AI] Logout button clicked (Vanilla JS)"),handleLogout()}),alttextaiDebug&&console.log("[AltText AI] Logout button found and listener attached")}else alttextaiDebug&&console.log("[AltText AI] Logout button not found");alttextaiDebug&&(document.getElementById("alttext-auth-modal")?console.log("[AltText AI] Auth modal found"):console.log("[AltText AI] Auth modal not found - may need to be created"),void 0!==window.authModal?console.log("[AltText AI] authModal object found"):console.log("[AltText AI] authModal object not found")),initCountdownTimer()});
>>>>>>> origin/main
